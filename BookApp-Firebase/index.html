<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book CRUD</title>

<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background:#f5f5f5;
    }
    h3, h4 {
        margin: 10px 0;
    }
    input {
        padding: 8px;
        margin: 5px;
        border: 1px solid #aaa;
        border-radius: 4px;
    }
    button {
        padding: 8px 14px;
        cursor: pointer;
        border: none;
        background: #007bff;
        color: white;
        border-radius: 4px;
    }
    button:hover {
        background:#0056b3;
    }
    .card {
        border: 1px solid #ccc;
        padding: 12px;
        margin-top: 12px;
        background:white;
        border-radius: 6px;
        width: 200px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card img {
        width: 100%;
        height: 110px;
        object-fit: cover;
        border-radius:4px;
        border:1px solid #ddd;
    }
    .btn-small {
        background:#444;
        padding:6px 10px;
        font-size: 12px;
        margin-right:5px;
        border-radius:4px;
    }
    .btn-del {
        background:#d0342c;
    }
</style>
</head>

<body>

<h3>Book App</h3>

<input id="title" type="text" placeholder="Title">
<input id="author" type="text" placeholder="Author">
<input id="price" type="number" placeholder="Price">
<button onclick="addBook()">Add</button>

<h4>Books List</h4>
<div id="bookList"></div>

<script>

    
    const BASE_URL = "https://auroratime-24dbe-default-rtdb.asia-southeast1.firebasedatabase.app/";

    const DEFAULT_IMG = "https://m.media-amazon.com/images/I/71aFt4+OTOL.jpg";


    function addBook() {
        let title = document.getElementById("title").value;
        let author = document.getElementById("author").value;
        let price = document.getElementById("price").value;

        if (!title || !author || !price) {
            alert("Enter all details");
            return;
        }

        let book = { title, author, price, image: DEFAULT_IMG };

        fetch(BASE_URL + "books.json", {
            method: "POST",
            body: JSON.stringify(book)
        }).then(() => {
            alert("Book Added");
            loadBooks();
        });
    }

    function loadBooks() {
        fetch(BASE_URL + "books.json")
        .then(res => res.json())
        .then(data => showBooks(data));
    }


    function showBooks(data) {
        let div = document.getElementById("bookList");
        div.innerHTML = "";

        if (!data) return;

        Object.entries(data).forEach(([id, book]) => {
            let card = document.createElement("div");
            card.className = "card";

            card.innerHTML = `
                <img src="${book.image}">
                <p><b>${book.title}</b></p>
                <p>Author: ${book.author}</p>
                <p>Price: ${book.price}</p>
                <button class="btn-small" onclick="editBook('${id}','${book.title}','${book.author}','${book.price}')">Edit</button>
                <button class="btn-small btn-del" onclick="deleteBook('${id}')">Delete</button>
            `;

            div.appendChild(card);
        });
    }


    function editBook(id, oldTitle, oldAuthor, oldPrice) {
        let newTitle = prompt("New Title", oldTitle);
        let newAuthor = prompt("New Author", oldAuthor);
        let newPrice = prompt("New Price", oldPrice);

        if (!newTitle || !newAuthor || !newPrice) return;

        let updated = { title: newTitle, author: newAuthor, price: newPrice, image: DEFAULT_IMG };

        fetch(BASE_URL + "books/" + id + ".json", {
            method: "PATCH",
            body: JSON.stringify(updated)
        }).then(() => {
            alert("Updated");
            loadBooks();
        });
    }


    function deleteBook(id) {
        fetch(BASE_URL + "books/" + id + ".json", {
            method: "DELETE"
        }).then(() => {
            alert("Deleted");
            loadBooks();
        });
    }
    loadBooks();

</script>
</body>
</html>
